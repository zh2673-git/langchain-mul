# 更新日志

## [1.3.3] - 2025-03-14

### 修复
- 修复了ModelScope API响应解析问题，添加了对'images'字段的支持
- 增强了URL提取逻辑，确保能正确识别ModelScope返回的图像URL
- 优化了错误处理，提高了系统稳定性

## [1.3.2] - 2025-03-14

### 改进
- 添加了对"生成图片"命令的支持，使其与"生成图像"命令一样能够调用图像生成功能
- 优化了命令识别逻辑，提高了用户体验
- 统一了图像生成相关的命令格式，使系统更加直观易用

## [1.3.1] - 2025-03-14

### 修复
- 修复了ModelScope API的图像生成功能，使用正确的端点URL：`/v1/images/generations`
- 优化了ModelScope API的错误处理，提供更详细的日志信息
- 更新了`.env.example`文件中的ModelScope API配置示例
- 完善了图像生成功能的回退机制，确保在主要端点失败时能尝试备选方案

## [1.3.0] - 2025-03-14

### 修复
- 修复了ModelScope API的图像生成功能，解决了404错误问题
- 添加了对ModelScope API的专门支持，使用正确的文本到图像端点
- 实现了两个备选端点，提高了与ModelScope API的兼容性
- 增强了响应处理，支持多种返回格式（URL、Base64、图像路径）
- 添加了详细的日志记录，便于调试和监控

## [1.2.9] - 2025-03-14

### 修复
- 修复了视频生成功能中的 `'OpenAI' object has no attribute 'videos'` 错误
- 添加了备选方案，当标准视频生成API不可用时自动使用聊天API
- 增强了错误处理和日志记录，提供更详细的调试信息
- 优化了URL提取逻辑，支持从文本响应中提取视频链接

## [1.2.8] - 2025-03-15

### 新增
- 添加了在对话中直接切换模型的功能
- 新增"列出模型"命令，显示所有可用的模型配置
- 新增"切换[类型]模型:[编号]"命令，可以在对话中快速切换不同的模型
- 切换嵌入模型时会自动重新处理已加载的文档

## [1.2.7] - 2025-03-14

### 修复
- 修复了OpenRouter API的图像生成功能，完全重写了处理逻辑
- 放弃使用不支持的`/images/generations`端点，改为使用聊天API
- 为Stable Diffusion模型添加了特定的提示词格式，提高生成质量
- 增强了图像URL提取功能，支持从文本响应中提取URL
- 添加了本地占位图像生成功能，确保即使API返回无效响应也能提供反馈

## [1.2.6] - 2025-03-14

### 修复
- 修复了OpenRouter API的图像生成功能，为Stable Diffusion模型添加了专门的处理逻辑
- 使用正确的`/images/generations` API端点处理Stable Diffusion模型请求
- 修复了OpenRouter API的视频生成功能，解决了`'OpenAI' object has no attribute 'videos'`错误
- 为视频生成添加了专门的聊天API处理逻辑，确保与OpenRouter兼容
- 优化了API请求格式和错误处理，提高了系统稳定性

## [1.2.5] - 2025-03-14

### 改进
- 更新了OpenRouter API配置，使用免费模型进行文本、图像和视频生成
- 将文本模型从qwen/qwq-32b:free更改为google/gemma-7b-it:free，提供更稳定的性能
- 将图像模型设置为stability.stable-diffusion-xl-1.0:free，确保高质量图像生成
- 配置视频模型为openai/sora:free，启用免费视频生成功能
- 统一了所有API密钥和端点配置，简化了维护工作

## [1.2.4] - 2025-03-14

### 修复
- 改进了OpenRouter API的图像生成功能，自动检测并切换到支持图像生成的模型
- 为不支持图像生成的模型（如Gemma、Claude文本模型）添加了备选方案
- 优化了请求数据格式，使其更适合图像生成任务
- 增强了日志记录，提供更详细的请求信息用于调试

## [1.2.3] - 2025-03-14

### 修复
- 修复了OpenRouter API URL中出现双斜杠导致的404错误问题
- 优化了URL构建逻辑，确保生成正确的API端点路径
- 增强了URL格式检查，避免类似的路径拼接错误

## [1.2.2] - 2025-03-14

### 修复
- 添加了对OpenRouter API的专门支持，解决了405错误问题
- 优化了图像生成功能，使用聊天API代替不支持的图像生成API
- 增强了URL和Base64图像的提取能力，支持更多图像格式
- 改进了错误处理，添加了多级备选方案，提高系统健壮性

## [1.2.1] - 2025-03-14

### 修复
- 为jimeng模型添加了专门的处理逻辑，确保正确调用图像生成API
- 优化了本地图像服务器的请求格式，使用正确的API路径和参数
- 增强了对不同模型的识别和处理，避免错误地使用文本生成API
- 改进了日志记录，提供更详细的调试信息

## [1.2.0] - 2025-03-14

### 修复
- 修复了本地图像服务器API路径问题，根据错误信息调整为使用聊天API
- 添加了本地占位图像生成功能，当服务器不返回图像URL时创建本地图像
- 增强了错误处理，提供更友好的用户体验
- 改进了日志记录，提供更详细的调试信息

## [1.1.9] - 2025-03-14

### 修复
- 修复了处理URL对象时的类型错误，确保正确将URL对象转换为字符串
- 增强了本地图像服务器URL处理的健壮性
- 改进了错误处理，提供更详细的日志信息

## [1.1.8] - 2025-03-14

### 修复
- 修复了使用本地图像服务器时的错误，增强了对不同响应格式的兼容性
- 添加了使用requests直接调用本地图像服务器的备选方法
- 改进了错误处理和日志记录，提供更详细的调试信息
- 优化了本地服务器URL构建逻辑，确保正确访问API端点

## [1.1.7] - 2025-03-14

### 新增
- 添加了网页图像查看功能，用户可以在浏览器中查看生成的图像和视频
- 增加了"查看图像"命令，可以打开浏览器查看所有生成的图像和视频
- 实现了简单的HTTP服务器，支持在网页中展示生成的媒体内容
- 优化了图像和视频生成的用户体验，提供更直观的查看方式

## [1.1.6] - 2025-03-14

### 修复
- 添加了对ModelScope API的支持，自动启用流式模式
- 修复了使用ModelScope API时出现的400错误问题
- 增强了API兼容性，自动检测并适配不同API提供商的特殊要求

## [1.1.5] - 2025-03-14

### 功能增强
- 改进了程序启动流程，不再强制要求用户立即加载文件
- 添加了纯聊天模式，用户可以在不加载文件的情况下与系统交互
- 增加了"加载文件"命令作为"新文件"命令的别名
- 优化了用户界面，显示当前状态（已加载文件/未加载文件）
- 改进了提示信息，使用户更容易理解可用的命令和功能

## [1.1.4] - 2025-03-14

### 优化
- 优化了硅基流动API的处理，减小批处理大小（从8减至4）以避免413错误
- 添加了文本截断功能，限制单个文本长度不超过1000字符
- 为硅基流动API使用更小的文档分割块大小（500字符，而非默认的1000字符）
- 增加了更详细的日志记录，便于调试和监控嵌入过程

## [1.1.3] - 2025-03-14

### 修复
- 为硅基流动API实现了自定义嵌入模型类，解决了400错误问题
- 添加了文本批处理功能，避免长文本嵌入失败
- 增强了错误处理，确保即使部分嵌入失败也能继续处理
- 优化了API请求格式，符合硅基流动API的要求

## [1.1.2] - 2025-03-14

### 修复
- 修复了硅基流动API URL中出现重复`/embeddings`路径的问题
- 更新了API基础URL配置，现在应设置为`https://api.siliconflow.cn/v1`
- 更新了文档和示例配置，确保用户能正确配置硅基流动API

## [1.1.1] - 2025-03-14

### 修复
- 进一步修复了硅基流动API的URL路径问题，现在只需设置基本域名
- 更新了文档，提供了更清晰的硅基流动API配置说明
- 改进了API URL处理逻辑，增强了系统的健壮性

## [1.1.0] - 2025-03-14

### 新增
- 添加了对硅基流动API的支持
- 创建了安装脚本`install_deps.py`，帮助用户解决依赖冲突问题
- 添加了图像和视频生成功能
- 增强了模型配置的灵活性，支持多种模型类型

### 修复
- 修复了硅基流动API的URL路径问题
- 解决了依赖冲突问题，使用更宽松的版本约束
- 改进了错误处理，提供更清晰的错误信息
- 增加了备选加载器，提高了系统的健壮性

### 改进
- 更新了README.md，添加了更详细的安装和配置说明
- 优化了文档加载过程，支持更多文件格式
- 增强了聊天历史功能，提供更好的上下文理解
- 改进了向量存储的创建和检索过程

## [1.0.0] - 2025-03-01

### 初始版本
- 基于LangChain 0.3版本构建的文档聊天系统
- 支持PDF、Word、Excel、CSV、Markdown、TXT等多种文件格式
- 使用向量数据库进行语义搜索
- 基于检索增强生成(RAG)技术提高回答准确性
- 支持OpenAI和HuggingFace模型 